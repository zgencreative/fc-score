{% extends "template.html" %} {% block content %}
<div class="container my-5">
  <div class="row">
    <!-- Sidebar Kiri -->
    <div class="col-md-3">
      <div
        class="text-light p-3 bg-dark rounded"
        style="overflow-y: auto"
        id="leftSide"
      ></div>
    </div>

    <!-- Main Content Tengah -->
    <div class="col-md-9" id="main-div">
      <div class="p-3 rounded shadow-sm bg-dark text-light">
        <p>
          <a href="/" style="text-decoration: none">
            <i class="fas fa-arrow-left" style="color: white"></i>
          </a>
        </p>
        <div class="match-header">
          <div class="team">
            <img
              src="{{ data['data']['Team1']['IMGTeam'] }}"
              alt="{{ data['data']['Team1']['NMTeam'] }}"
              class="team-logo"
            />
            <div class="detail-name" id="name-team1">
              {{ data['data']['Team1']['NMTeam'] }}
            </div>
          </div>
          <div class="detail-info">
            <div class="detail-time">{{ data['data']['time_start'] }}</div>
            <div class="score fs-2">
              {% if data['data']['Score1'] != '' %} {{ data['data']['Score1'] }}
              - {{ data['data']['Score2'] }} {% endif %}
            </div>
            <div class="detail-status">{{ data['data']['Status_Match'] }}</div>
          </div>
          <div class="team">
            <img
              src="{{ data['data']['Team2']['IMGTeam'] }}"
              alt="{{ data['data']['Team2']['NMTeam'] }}"
              class="team-logo"
            />
            <div class="detail-name" id="name-team2">
              {{ data['data']['Team2']['NMTeam'] }}
            </div>
          </div>
        </div>

        <!-- Menu Section -->
        <div class="menu-bar">
          <div class="menu-items">
            <a href="#" id="summary-link" class="menu-link active">SUMMARY</a>
            <p class="menu-link" id="stats-link">STATS</p>
            <p class="menu-link" id="lineups-link">LINE-UPS</p>
            <p class="menu-link" id="table-link">TABLE</p>
          </div>
          <div class="menu-icons">
            <img src={{ url_for('static', filename='img/lapangan.png') }}
            class="icon-placeholder" alt="lapangan">
          </div>
        </div>

        <!-- Dynamic Content Section -->
        <div class="container mt-4" id="dinamic-content">
          {# Inisialisasi untuk menyimpan skor setiap babak #} {% if
          data['data']['timeline']|length != 0 %} {% for half, events in
          data['data']['timeline'].items() %} {% set ns = namespace(scores=[0,
          0]) %} {# Inisialisasi skor untuk babak ini #}

          <!-- Timeline Peristiwa -->
          {% for event in events %} {% if event['score']|length != 0 %} {% set
          ns.scores = event['score'] %} {# Perbarui skor jika ada #} {% endif %}
          <div
            class="py-2 bg-dark text-white {% if event['team'] == 1 %}text-start{% else %}text-end{% endif %}"
          >
            <div class="col-12">
              {% if event['team'] == 1 %} {% if half != '4' %}
              <span>{{ event['min'] }}'</span>
              {% endif %}
              <small
                >{% if event['score']|length > 0 and event['player'][0]['info']
                == 'goal' and event['player']|length > 1 %}({{
                event['player'][1]['pn'] }}){%endif%}
                <b>{{ event['player'][0]['pn'] }}</b></small
              >
              <span class="p-1">
                {% if event['score']|length > 0 and event['player'][0]['info']
                == 'goal' %}
                <img src="{{ url_for('static', filename='img/ball.png') }}" />
                {% else %} {% if 'info' in event['player'][0] and
                event['player'][0]['info'] == 'yellow card' %}
                <img
                  src="{{ url_for('static', filename='img/yellow_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'red card' %}
                <img
                  src="{{ url_for('static', filename='img/red_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'yellow-red card' %}
                <img
                  src="{{ url_for('static', filename='img/double_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'pen-no-goal' %}
                <img
                  src="{{ url_for('static', filename='img/no_goal.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'pen-goal' %}
                <img src="{{ url_for('static', filename='img/goal.png') }}" />
                {% else %}
                <span class="px-2 py-1 border rounded">VAR</span>
                {% endif %} {% endif %}
              </span>
              {% if event['score']|length > 0 %}
              <center>{{ns.scores[0]}} - {{ns.scores[1]}}</center>
              {% endif %} {% else %} {% if event['score']|length > 0 %}
              <center>{{ns.scores[0]}} - {{ns.scores[1]}}</center>
              {% endif %}
              <span class="p-1">
                {% if event['score']|length > 0 and event['player'][0]['info']
                == 'goal' %}
                <img src="{{ url_for('static', filename='img/ball.png') }}" />
                {% else %} {% if 'info' in event['player'][0] and
                event['player'][0]['info'] == 'yellow card' %}
                <img
                  src="{{ url_for('static', filename='img/yellow_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'red card' %}
                <img
                  src="{{ url_for('static', filename='img/red_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'yellow-red card' %}
                <img
                  src="{{ url_for('static', filename='img/double_card.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'pen-no-goal' %}
                <img
                  src="{{ url_for('static', filename='img/no_goal.png') }}"
                />
                {% elif 'info' in event['player'][0] and
                event['player'][0]['info'] == 'pen-goal' %}
                <img src="{{ url_for('static', filename='img/goal.png') }}" />
                {% else %}
                <span class="px-2 py-1 border rounded">VAR</span>
                {% endif %} {% endif %}
              </span>
              <small
                ><b>{{ event['player'][0]['pn'] }}</b> {% if
                event['score']|length > 0 and event['player'][0]['info'] ==
                'goal' and event['player']|length > 1 %}({{
                event['player'][1]['pn'] }}){%endif%}</small
              >
              {% if half != '4' %}
              <span>{{ event['min'] }}'</span>
              {% endif %} {% endif %}
            </div>
          </div>
          {% endfor %} {# Simpan skor akhir babak #}

          <!-- Penutup Babak -->
          <div
            class="p-2 d-flex justify-content-between bg-secondary rounded text-white"
          >
            <span>
              {% if half == '1' %} HT {% elif half == '2' %} FT {% elif half ==
              '3' %} AET {% elif half == '4' %} PEN {% else %} {{ half }}th Half
              {% endif %}
            </span>
            <span>{{ ns.scores[0] }} - {{ ns.scores[1] }}</span>
          </div>
          {% endfor %} {% endif %}
        </div>
      </div>
    </div>
  </div>
  {% block extra_js%}
  <script>
    // JavaScript untuk memotong nama pemain jika terlalu panjang
    document.querySelectorAll(".player-name").forEach((element) => {
      const fullName = element.getAttribute("data-name");
      const maxLength = 10; // Maksimal karakter yang diizinkan
      if (fullName.length > maxLength) {
        // Format nama: ambil nama depan dan inisial nama belakang
        const nameParts = fullName.split(" ");
        const formattedName =
          nameParts.length > 1
            ? `${nameParts[0]} ${nameParts[1][0]}.` // Nama depan + inisial nama belakang
            : fullName.slice(0, maxLength - 1) + "."; // Jika hanya satu kata
        element.textContent = formattedName;
      } else {
        element.textContent = fullName;
      }
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Ambil path dari URL
      const currentPath = window.location.pathname; // Contoh: "/match/1251295"
      const segments = currentPath.split("/"); // ["", "match", "1251295"]
      const idTable = `${segments[2]}.${segments[3]}`;
      const id = segments[segments.length - 2]; // Ambil elemen terakhir sebagai ID ("1251295")
      const keyTitles = {
        blsh: "Blocked Shot",
        catt: "Counter Attack",
        crs: "Corner Kicks",
        fls: "Fouls",
        gks: "Goalkeeper Saves",
        goa: "Goal kicks",
        ofs: "Offsides",
        pss: "Posession (%)",
        shof: "Shots Off Target",
        shon: "Shots On Target",
        ths: "Throw ins",
        ycs: "Yellow Cards",
        rcs: "Red Cards",
      };

      // Pastikan ID valid sebelum melanjutkan
      if (!id) {
        console.error("ID not found in the URL!");
        return;
      }

      const summary_link = document.getElementById("summary-link");
      summary_link.href = currentPath;

      // Daftar link dengan endpoint dinamis
      const links = [
        {
          id: "stats-link",
          endpoint: (id) => `/api/football/detailMatch/stat/${id}/`,
        },
        {
          id: "lineups-link",
          endpoint: (id) => `/api/football/detailMatch/lineup/${id}`,
        },
        {
          id: "table-link",
          endpoint: (id) => `/api/football/detailMatch/table/${idTable}`,
        },
      ];

      // Iterasi setiap link dan tambahkan event listener
      links.forEach((link) => {
        const element = document.getElementById(link.id);

        // Pastikan elemen dengan ID tersebut ada
        if (!element) {
          console.warn(`Element with ID "${link.id}" not found.`);
          return;
        }

        // Tambahkan event listener ke elemen
        element.addEventListener("click", function (event) {
          event.preventDefault(); // Cegah tindakan default (misalnya, navigasi <a>)

          // Hapus class active dari semua elemen lainnya
          summary_link.classList.remove("active");
          links.forEach((otherLink) => {
            const otherElement = document.getElementById(otherLink.id);
            if (otherElement && otherElement.classList.contains("active")) {
              otherElement.classList.remove("active");
            }
          });

          // Tambahkan class active ke elemen yang diklik
          element.classList.add("active");

          // Kirim fetch request ke endpoint
          fetch(link.endpoint(id), {
            method: "GET",
            headers: { "Content-Type": "application/json" },
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              const container = document.getElementById("dinamic-content");
              container.innerHTML = "";
              if (link.id == "stats-link") {
                const match = data.data[0];

                // Looping untuk menghitung persentase dan menampilkan hasil
                for (const key in match.sum_stat[0]) {
                  const value0 = match.sum_stat[0][key] || 0;
                  const value1 = match.sum_stat[1][key] || 0;
                  const total = value0 + value1;

                  if (total > 0) {
                    const value0Percent = Math.round((value0 / total) * 100);
                    const value1Percent = Math.round((value1 / total) * 100);
                    const remaining0 = 100 - value0Percent;
                    const remaining1 = 100 - value1Percent;

                    // Buat elemen wrapper untuk setiap statistik
                    const statWrapper = document.createElement("div");

                    // Bagian atas
                    statWrapper.innerHTML += `
                      <div class="d-flex justify-content-between py-2">
                        <span class="text-light">${value0}</span>
                        <span class="stat-label">${keyTitles[key] || key}</span>
                        <span class="text-light">${value1}</span>
                      </div>
                      <div class="d-flex justify-content-between">
                        <div class="pe-1 gap-1 d-flex justify-content-between w-50">
                          <div class="dot-white rounded-start" style="width: ${remaining0}%;"></div>
                          <div class="dot-orange rounded-end" style="width: ${value0Percent}%;"></div>
                        </div>
                        <div class="ps-1 gap-1 d-flex justify-content-between w-50">
                          <div class="dot-orange rounded-start" style="width: ${value1Percent}%;"></div>
                          <div class="dot-white rounded-end" style="width: ${remaining1}%;"></div>
                        </div>
                        </div>
                      </div>
                    `;

                    // Tambahkan wrapper ke container
                    container.appendChild(statWrapper);
                  }
                }
              } else if (link.id == "lineups-link") {
                const positionsTeam1 = {
                  1: { x: [47], y: "5%" },
                  2: { x: [26, 66], y: "17%" },
                  3: { x: [16, 47, 76], y: "25%" },
                  4: { x: [11, 31, 61, 81], y: "35%" },
                  5: { x: [8, 26, 47, 68, 86], y: "42%" },
                };
                const positionsTeam2 = {
                  1: { x: [47], y: "91%" },
                  2: { x: [26, 66], y: "79%" },
                  3: { x: [16, 47, 76], y: "71%" },
                  4: { x: [11, 31, 61, 81], y: "61%" },
                  5: { x: [8, 26, 47, 68, 86], y: "54%" },
                };
                const team1 = data.data.Team1;
                const team2 = data.data.Team2;
                const name_team1 =
                  document.getElementById("name-team1").innerText;
                const name_team2 =
                  document.getElementById("name-team2").innerText;
                const field_container = document.createElement("div");
                field_container.classList.add("field-container");
                field_container.innerHTML = `
                <img
                  src="{{ url_for('static', filename='img/lapangan_posisi.png') }}"
                  alt="Soccer Field"
                  style="opacity: 0.6;"
                  class="field-image"
                />
                <div class="name-team" style="top: 1%; left: 6%">
                  <b>${name_team1}</b> ${team1.Fo.join("-")}
                </div>
                <div class="name-team" style="top: 96%; left: 6%">
                  <b>${name_team2}</b> ${team2.Fo.join("-")}
                </div>
                `;
                container.appendChild(field_container);
                createPlayerElements(team1, positionsTeam1, "team1");
                createPlayerElements(team2, positionsTeam2, "team2");
                createSubs(team1, team2);
                createSubsPlayer(team1, team2);
                createIS(team1, team2);
                createCoach(team1, team2);
              } else if (link.id == "table-link") {
                const name_team1 =
                  document.getElementById("name-team1").innerText;
                const name_team2 =
                  document.getElementById("name-team2").innerText;
                const tableRank = data.data.LeagueTable;
                const tableContainer = document.createElement("div");
                tableContainer.style.margin = "12px 0 12px";

                // Menambahkan tabel dengan struktur HTML
                tableContainer.innerHTML = `
                  <table>
                    <thead>
                      <tr>
                        <th style="font-weight: 500; width: 5%">#</th>
                        <th style="width: 40%">TEAM</th>
                        <th style="width: 7.5%">P</th>
                        <th style="width: 7.5%">W</th>
                        <th style="width: 7.5%">D</th>
                        <th style="width: 7.5%">L</th>
                        <th style="width: 7.5%">F</th>
                        <th style="width: 7.5%">A</th>
                        <th style="width: 7.5%">GD</th>
                        <th style="width: 7.5%">PTS</th>
                      </tr>
                    </thead>
                    <tbody id="rankTable"></tbody>
                  </table>
                `;

                // Menambahkan tableContainer ke dalam container utama
                container.appendChild(tableContainer);

                // Menyiapkan tbody untuk menambahkan data tim
                const rankTable = document.getElementById("rankTable");

                // Menggunakan loop untuk menambahkan data ke dalam table
                tableRank.forEach((team) => {
                  // Membuat baris baru (tr) untuk setiap tim
                  const row = document.createElement("tr");
                  row.classList.add("bg-black");
                  if (team.teamNM != name_team1 && team.teamNM != name_team2) {
                    row.classList.remove("bg-black");
                  }

                  row.style.fontSize = "14px";

                  // Menambahkan data ke dalam setiap sel (td)
                  row.innerHTML = `
                    <td style="font-weight: 500; width: 5%; color: white">${team.rank}</td>
                    <td style="width: 40%; color: white">
                      <img
                        loading="lazy"
                        src="${team.teamIMG}"
                        class="icon"
                        style="height: 30px; width: 30px"
                      />
                      ${team.teamNM}
                    </td>
                    <td style="width: 7.5%; color: white">${team.p}</td>
                    <td style="width: 7.5%; color: white">${team.w}</td>
                    <td style="width: 7.5%; color: white">${team.d}</td>
                    <td style="width: 7.5%; color: white">${team.l}</td>
                    <td style="width: 7.5%; color: white">${team.f}</td>
                    <td style="width: 7.5%; color: white">${team.a}</td>
                    <td style="width: 7.5%; color: white">${team.gd}</td>
                    <td style="width: 7.5%; color: white">${team.pts}</td>
                  `;

                  // Menambahkan baris baru ke dalam tbody
                  rankTable.appendChild(row);
                });
              } else {
                console.error("Container element not found!");
              }
            })
            .catch((error) => {
              console.error(`Error fetching ${link.endpoint(id)}:`, error);
            });
        });
      });
    });

    function createCoach(team1Data, team2Data) {
      const container = document.getElementById("dinamic-content");

      const subs_container = document.createElement("div");
      subs_container.classList.add("py-2");
      subs_container.innerHTML = `
        <span class="fw-10">COACHES</span>
      `;
      container.appendChild(subs_container);

      const subs_content = document.createElement("div");
      subs_content.classList.add("border", "rounded");

      for (let i = 0; i < team1Data["Pos"].length; i++) {
        if (team1Data["Pos"][i]["Pon"] == "COACH") {
          for (let j = 0; j < team2Data["Pos"].length; j++) {
            if (team2Data["Pos"][j]["Pon"] == "COACH") {
              const subElement = document.createElement("div");
              subElement.classList.add(
                "substitution",
                "d-flex",
                "justify-content-between",
                "align-items-center"
              );
              subElement.innerHTML = `
                <div class="subs">
                  <span class="px-2">${team1Data["Pos"][i]["Fn"]} ${team1Data["Pos"][i]["Ln"]}</span>
                </div>

                <div class="subs">
                  <span class="px-2">${team2Data["Pos"][j]["Fn"]} ${team2Data["Pos"][j]["Ln"]}</span>
                </div>
              `;
              subs_content.appendChild(subElement);
            }
          }
        }
      }

      // Tambahkan subs_content ke container jika ada isinya
      if (subs_content.children.length > 0) {
        subs_container.appendChild(subs_content);
      }
    }

    function createIS(team1Data, team2Data) {
      var len = team1Data.IS.length;
      const container = document.getElementById("dinamic-content");

      if (team1Data.IS.length < team2Data.IS.length) {
        len = team2Data.IS.length;
      }

      const subs_container = document.createElement("div");
      subs_container.classList.add("py-2");
      subs_container.innerHTML = `
        <span class="fw-10">INJURIES & SUSPENSIONS</span>
      `;
      container.appendChild(subs_container);

      const subs_content = document.createElement("div");
      subs_content.classList.add("border", "rounded");

      for (let i = 0; i < len; i += 1) {
        // Periksa apakah data untuk tim 1 dan tim 2 tersedia
        const team1Sub = team1Data.IS[i];
        const team2Sub = team2Data.IS[i];

        // Hanya tambahkan div jika ada data substitusi
        if (team1Sub || team2Sub) {
          console.log(team1Sub, team2Sub);
          const subElement = document.createElement("div");
          subElement.classList.add(
            "substitution",
            "d-flex",
            "justify-content-between",
            "align-items-center"
          );

          // Tambahkan konten tim 1 jika ada
          if (team1Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div>
                <div class="out"><b>${team1Sub.Fn} ${team1Sub.Ln}</b></div>
                <div class="in">${team1Sub.Rs}</div>
              </div>
            </div>
          `;
          } else {
            subElement.innerHTML += `
            <div class="subs">
              <div>
                <div class="out"><b></b></div>
                <div class="in"></div>
              </div>
            </div>
          `;
          }

          // Tambahkan konten tim 2 jika ada
          if (team2Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div>
                <div class="out"><b>${team2Sub.Fn} ${team2Sub.Ln}</b></div>
                <div class="in">${team2Sub.Rs}</div>
              </div>
            </div>
          `;
          } else {
            subElement.innerHTML += `
            <div class="subs">
              <div>
                <div class="out"><b></b></div>
                <div class="in"></div>
              </div>
            </div>
          `;
          }

          subs_content.appendChild(subElement);
        }
      }

      // Tambahkan subs_content ke container jika ada isinya
      if (subs_content.children.length > 0) {
        subs_container.appendChild(subs_content);
      }
    }

    function createSubsPlayer(team1Data, team2Data) {
      var len = team1Data.Pos.length;
      const container = document.getElementById("dinamic-content");

      if (team1Data.Pos.length < team2Data.Pos.length) {
        len = team2Data.Pos.length;
      }

      const subs_container = document.createElement("div");
      subs_container.classList.add("py-2");
      subs_container.innerHTML = `
        <span class="fw-10">SUBSTITUTE PLAYERS</span>
      `;
      container.appendChild(subs_container);

      const subs_content = document.createElement("div");
      subs_content.classList.add("border", "rounded");

      for (let i = 0; i < len; i += 1) {
        // Periksa apakah data untuk tim 1 dan tim 2 tersedia
        const team1Sub = team1Data.Pos[i];
        const team2Sub = team2Data.Pos[i];

        // Hanya tambahkan div jika ada data substitusi
        if (
          (team1Sub && team1Sub.Pon == "SUBSTITUTE_PLAYER") ||
          (team2Sub && team2Sub.Pon == "SUBSTITUTE_PLAYER")
        ) {
          const subElement = document.createElement("div");
          subElement.classList.add(
            "substitution",
            "d-flex",
            "justify-content-between",
            "align-items-center"
          );

          // Tambahkan konten tim 1 jika ada
          if (team1Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div class="subs-time border rounded-circle">${team1Sub.Np}</div>
              <div>
                <div>
                  <span class="px-2">${team1Sub.Fn} ${team1Sub.Ln}</span>
                </div>
              </div>
            </div>
          `;
          }

          // Tambahkan konten tim 2 jika ada
          if (team2Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div class="subs-time border rounded-circle">${team1Sub.Np}</div>
              <div>
                <span class="px-2">${team2Sub.Fn} ${team2Sub.Ln}</span>
              </div>
            </div>
          `;
          }

          subs_content.appendChild(subElement);
        }
      }

      // Tambahkan subs_content ke container jika ada isinya
      if (subs_content.children.length > 0) {
        subs_container.appendChild(subs_content);
      }
    }

    function createSubs(team1Data, team2Data) {
      var len = team1Data.Subs.length;
      const container = document.getElementById("dinamic-content");

      if (team1Data.Subs.length < team2Data.Subs.length) {
        len = team2Data.Subs.length;
      }

      const subs_container = document.createElement("div");
      subs_container.classList.add("py-2");
      subs_container.innerHTML = `
        <span class="fw-10">SUBSTITUTION</span>
      `;
      container.appendChild(subs_container);

      const subs_content = document.createElement("div");
      subs_content.classList.add("border", "rounded");

      for (let i = 0; i < len; i += 2) {
        // Periksa apakah data untuk tim 1 dan tim 2 tersedia
        const team1Sub = team1Data.Subs[i];
        const team1SubNext = team1Data.Subs[i + 1];
        const team2Sub = team2Data.Subs[i];
        const team2SubNext = team2Data.Subs[i + 1];

        // Hanya tambahkan div jika ada data substitusi
        if (team1Sub || team2Sub) {
          const subElement = document.createElement("div");
          subElement.classList.add(
            "substitution",
            "d-flex",
            "justify-content-between",
            "align-items-center"
          );

          // Tambahkan konten tim 1 jika ada
          if (team1Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div class="subs-time">${team1Sub.Min}'</div>
              <div>
                <div class="out">
                  <i class="fas fa-arrow-alt-circle-down text-danger"></i>
                  ${team1Sub.Pn}
                </div>
                ${
                  team1SubNext
                    ? `<div class="in">
                        <i class="fas fa-arrow-alt-circle-up text-warning"></i>
                        <b>${team1SubNext.Pn}</b>
                      </div>`
                    : ""
                }
              </div>
            </div>
          `;
          }

          // Tambahkan konten tim 2 jika ada
          if (team2Sub) {
            subElement.innerHTML += `
            <div class="subs">
              <div class="subs-time">${team2Sub.Min}'</div>
              <div>
                <div class="out">
                  <i class="fas fa-arrow-alt-circle-down text-danger"></i>
                  ${team2Sub.Pn}
                </div>
                ${
                  team2SubNext
                    ? `<div class="in">
                        <i class="fas fa-arrow-alt-circle-up text-warning"></i>
                        <b>${team2SubNext.Pn}</b>
                      </div>`
                    : ""
                }
              </div>
            </div>
          `;
          }

          subs_content.appendChild(subElement);
        }
      }

      // Tambahkan subs_content ke container jika ada isinya
      if (subs_content.children.length > 0) {
        subs_container.appendChild(subs_content);
      }
    }

    // Fungsi untuk menambahkan elemen pemain
    function createPlayerElements(teamData, positions, teamClass) {
      // Pilih elemen field-container
      const fieldContainer = document.querySelector(".field-container");
      const container = document.getElementById("dinamic-content");

      // Iterasi pemain
      teamData.Pos.forEach((player) => {
        if (player.Fp && player.Fp != "1:1") {
          // Split Fp untuk mendapatkan posisi x dan y
          const [xIndex, yIndex] = player.Fp.split(":").map(Number);

          // Ambil posisi pemain dari Fo
          const positionKey = teamData.Fo[xIndex - 2];
          const positionData = positions[positionKey];

          // Hitung posisi x dan y
          const x = positionData.x[yIndex - 1];
          const y = positions[xIndex]["y"];

          // Buat elemen pemain
          const playerDiv = document.createElement("div");
          playerDiv.className = `player ${teamClass}`;
          playerDiv.style.top = y;
          playerDiv.style.left = `${x}%`;
          playerDiv.textContent = player.Np; // Tambahkan posisi pemain (GOALKEEPER, DEFENDER, etc.)

          // Membuat elemen span untuk nama pemain
          const playerNameSpan = document.createElement("span");
          playerNameSpan.className = "player-name";
          const fullName = `${player.Fn} ${player.Ln}`;
          const maxLength = 10; // Maksimal karakter yang diizinkan
          playerNameSpan.textContent = fullName;
          if (fullName.length > maxLength) {
            // Format nama: ambil nama depan dan inisial nama belakang
            const nameParts = fullName.split(" ");
            const formattedName =
              nameParts.length > 1
                ? `${nameParts[0]} ${nameParts[1][0]}.` // Nama depan + inisial nama belakang
                : fullName.slice(0, maxLength - 1) + "."; // Jika hanya satu kata
            playerNameSpan.textContent = formattedName;
          }
          playerDiv.appendChild(playerNameSpan); // Menambahkan span ke dalam playerDiv

          // Tambahkan elemen ke container
          fieldContainer.appendChild(playerDiv);
        } else if (player.Fp && player.Fp == "1:1") {
          const playerDiv = document.createElement("div");
          playerDiv.className = `player ${teamClass}`;
          if (teamClass == "team1") {
            playerDiv.style.top = "5%";
          } else {
            playerDiv.style.top = "91%";
          }
          playerDiv.style.left = "47%";
          playerDiv.textContent = player.Np; // Tambahkan posisi pemain (GOALKEEPER, DEFENDER, etc.)

          // Membuat elemen span untuk nama pemain
          const playerNameSpan = document.createElement("span");
          playerNameSpan.className = "player-name";
          const fullName = `${player.Fn} ${player.Ln}`;
          const maxLength = 10; // Maksimal karakter yang diizinkan
          playerNameSpan.textContent = fullName;
          if (fullName.length > maxLength) {
            // Format nama: ambil nama depan dan inisial nama belakang
            const nameParts = fullName.split(" ");
            const formattedName =
              nameParts.length > 1
                ? `${nameParts[0]} ${nameParts[1][0]}.` // Nama depan + inisial nama belakang
                : fullName.slice(0, maxLength - 1) + "."; // Jika hanya satu kata
            playerNameSpan.textContent = formattedName;
          }
          playerDiv.appendChild(playerNameSpan); // Menambahkan span ke dalam playerDiv

          // Tambahkan elemen ke container
          fieldContainer.appendChild(playerDiv);
        } else {
          console.error("Nope");
        }
      });
      container.appendChild(fieldContainer);
    }
  </script>

  <script>
    async function reloadInitialView() {
      try {
        // Melakukan permintaan ke API untuk data awal
        const response = await fetch("/api/search/", {
          method: "GET", // Atur metode (GET/POST, dsb.)
          headers: {
            "Content-Type": "application/json", // Tipe konten permintaan
          },
        });
        const data = await response.json();

        const leftBar = document.getElementById("leftSide");
        leftBar.innerHTML = ""; // Kosongkan konten sebelumnya

        // Membuat Search Bar
        const searchDiv = document.createElement("div");
        searchDiv.classList.add("mb-4");
        searchDiv.innerHTML = `
          <input
            type="text"
            class="form-control"
            placeholder="Search..."
            id="searchInput"
          />
        `;
        leftBar.appendChild(searchDiv);

        // Membuat Region Section
        const regionDiv = document.createElement("div");
        regionDiv.classList.add("mb-4");
        regionDiv.innerHTML = `<h6 class="text-uppercase">Region</h6>`;
        const regionList = document.createElement("ul");
        regionList.classList.add("list-unstyled");
        regionList.id = "region";

        data.data.categories.forEach((region) => {
          const li = document.createElement("li");
          li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
          li.id = "leftCard";
          li.setAttribute(
            "onclick",
            `detailCountry('${region.Ccd}', '${region.Cnm}')`
          );
          li.innerHTML = `
            <img
              src="${region.badgeUrl || "default-region.png"}"
              alt="${region.Ccd}"
              class="me-3"
              style="width: 20px; object-fit: cover"
            />
            <div class="d-flex flex-column">
              <span class="text-truncate">${region.Cnm}</span>
              <small class="text-light text-truncate"></small>
            </div>
          `;
          regionList.appendChild(li);
        });
        regionDiv.appendChild(regionList);
        leftBar.appendChild(regionDiv);

        // Membuat Teams Section
        const teamsDiv = document.createElement("div");
        teamsDiv.innerHTML = `<h6 class="text-uppercase">Teams</h6>`;
        const teamsList = document.createElement("ul");
        teamsList.classList.add("list-unstyled");
        teamsList.id = "teams";

        data.data.teams.forEach((team) => {
          const li = document.createElement("li");
          li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
          li.id = "leftCard";
          li.innerHTML = `
            <img
              src="${team.IMGTeam || "default-team.png"}"
              alt="${team.NMTeam}"
              class="me-3"
              style="width: 20px; object-fit: cover"
            />
            <div class="d-flex flex-column">
              <span class="text-truncate">${team.NMTeam}</span>
              <small class="text-light text-truncate">${team.CoNm}</small>
            </div>
          `;
          teamsList.appendChild(li);
        });
        teamsDiv.appendChild(teamsList);
        leftBar.appendChild(teamsDiv);

        // Membuat Competition Section
        const competitionDiv = document.createElement("div");
        competitionDiv.classList.add("mb-4");
        competitionDiv.innerHTML = `<h6 class="text-uppercase">Competition</h6>`;
        const competitionList = document.createElement("ul");
        competitionList.classList.add("list-unstyled");
        competitionList.id = "competition";

        data.data.stages.forEach((competition) => {
          const li = document.createElement("li");
          li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
          li.id = "leftCard";
          li.innerHTML = `
            <img
              src="${competition.badgeUrl || "default-competition.png"}"
              alt="${competition.Scd}"
              class="me-3"
              style="width: 20px; object-fit: cover"
            />
            <div class="d-flex flex-column">
              <span class="text-truncate">${competition.Snm}</span>
              <small class="text-light text-truncate">${competition.Cnm}</small>
            </div>
          `;
          li.addEventListener("click", () => {
            var modifiedString = competition.urlComp.replace(".", "/");
            window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
          });
          competitionList.appendChild(li);
        });
        competitionDiv.appendChild(competitionList);
        leftBar.appendChild(competitionDiv);

        // Tambahkan event listener ke searchInput untuk live search
        const searchInput = document.getElementById("searchInput");
        searchInput.addEventListener(
          "input",
          debounce(async (e) => {
            const query = e.target.value.trim(); // Dapatkan teks pencarian
            if (query) {
              await performSearch(query); // Panggil fungsi pencarian
            } else {
              reloadInitialView(); // Reset ke tampilan awal jika input kosong
            }
          }, 300) // Debounce selama 300ms
        );
      } catch (error) {
        console.error("Error fetching data:", error);
      }
    }

    // Fungsi debounce
    const debounce = (func, delay) => {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => func(...args), delay);
      };
    };

    // Fungsi performSearch
    const performSearch = async (query) => {
      try {
        const response = await fetch(`/api/search/${query}/`);
        const data = await response.json();

        const regionList = document.getElementById("region");
        const teamList = document.getElementById("teams");
        const compList = document.getElementById("competition");

        // Kosongkan daftar sebelumnya
        regionList.innerHTML = "";
        teamList.innerHTML = "";
        compList.innerHTML = "";

        // Tambahkan hasil pencarian
        populateList(regionList, data.data.categories, createRegionItem);
        populateList(teamList, data.data.teams, createTeamItem);
        populateList(compList, data.data.stages, createCompetitionItem);
      } catch (error) {
        console.error("Error in performSearch:", error);
      }
    };

    // Fungsi untuk mengisi daftar
    const populateList = (list, data, createItem) => {
      if (data && data.length) {
        data.forEach((item) => list.appendChild(createItem(item)));
      } else {
        list.innerHTML = "<li class='text-muted'>No results found</li>";
      }
    };

    // Fungsi pembuat item untuk region, team, dan competition
    const createRegionItem = (region) => {
      const li = document.createElement("li");
      li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
      li.id = "leftCard";
      li.setAttribute(
        "onclick",
        `detailCountry('${region.Ccd}', '${region.Cnm}')`
      );
      li.innerHTML = `
        <img
          src="${region.badgeUrl || "default-region.png"}"
          alt="${region.Ccd}"
          class="me-3"
          style="width: 20px; object-fit: cover"
        />
        <div class="d-flex flex-column">
          <span class="text-truncate">${region.Cnm}</span>
        </div>
      `;
      return li;
    };

    const createTeamItem = (team) => {
      const li = document.createElement("li");
      li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
      li.id = "leftCard";
      li.innerHTML = `
        <img
          src="${team.IMGTeam || "default-team.png"}"
          alt="${team.NMTeam}"
          class="me-3"
          style="width: 20px; object-fit: cover"
        />
        <div class="d-flex flex-column">
          <span class="text-truncate">${team.NMTeam}</span>
          <small class="text-light text-truncate">${team.CoNm}</small>
        </div>
      `;
      return li;
    };

    const createCompetitionItem = (competition) => {
      const li = document.createElement("li");
      li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
      li.id = "leftCard";
      li.innerHTML = `
        <img
          src="${competition.badgeUrl || "default-competition.png"}"
          alt="${competition.Scd}"
          class="me-3"
          style="width: 20px; object-fit: cover"
        />
        <div class="d-flex flex-column">
          <span class="text-truncate">${competition.Snm}</span>
          <small class="text-light text-truncate">${competition.Cnm}</small>
        </div>
      `;
      li.addEventListener("click", () => {
        var modifiedString = competition.urlComp.replace(".", "/");
        window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
      });
      return li;
    };

    // Panggil fungsi utama saat halaman dimuat
    document.addEventListener("DOMContentLoaded", reloadInitialView);
  </script>
  <script>
    async function detailCountry(country, title) {
      try {
        // Melakukan permintaan ke API
        const response = await fetch(`/api/football/detailCountry/${country}`);
        const data = await response.json();

        const leftBar = document.getElementById("leftSide");
        leftBar.innerHTML = ""; // Kosongkan konten sebelumnya

        const countryData = data["data"];
        if (countryData && countryData.length > 0) {
          // Membuat elemen tombol kembali
          const div = document.createElement("div");
          div.classList.add("mb-4");
          div.innerHTML = `
            <button
              id="back-button"
              class="btn text-white d-flex align-items-center"
              onclick="reloadInitialView()"
            >
              <i class="fas fa-arrow-left"></i>
              <span id="header-title" class="ms-2">${title}</span>
            </button>`;
          leftBar.appendChild(div);

          // Membuat daftar kompetisi
          const ul = document.createElement("ul");
          ul.classList.add("list-unstyled");

          // Looping data kompetisi dan membuat elemen <li>
          countryData.forEach((datas) => {
            const li = document.createElement("li");
            li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
            li.id = "leftCard";

            li.innerHTML = `
              <img
                src="${datas.badgeUrl || "default-badge.png"}"
                alt="${datas.Scd}"
                class="me-3"
                style="width: 20px; object-fit: cover"
              />
              <div class="d-flex flex-column">
                <span>${datas.Snm}</span>
                <small class="text-light"></small>
              </div>
            `;
            li.addEventListener("click", () => {
              var modifiedString = datas.urlComp.replace(".", "/");
              window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
            });
            ul.appendChild(li);
          });

          // Menambahkan daftar ke dalam `leftBar`
          leftBar.appendChild(ul);
        }
      } catch (error) {
        console.error("Error fetching country details:", error);
      }
    }
  </script>
  {% endblock %} {% endblock %}
</div>
