{% extends "template.html" %} {% block extra_head %}
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
/>
<link
  rel="stylesheet"
  type="text/css"
  href="https://npmcdn.com/flatpickr/dist/themes/dark.css"
/>
{% endblock %} {% block content %}
<div class="container my-5">
  <div class="row">
    <!-- Sidebar Kiri -->
    <div class="col-md-3">
      <div
        class="text-light p-3 bg-dark rounded"
        style="overflow-y: auto"
        id="leftSide"
      ></div>
    </div>

    <!-- Main Content Tengah -->
    <div class="col-md-6" id="main-div">
      <div class="p-3 rounded shadow-sm bg-dark text-light">
        <!-- Calendar Header -->
        <div class="d-flex justify-content-between">
          <p class="mt-3" id="calendar-month"></p>
          <button class="btn text-light flatpickr" id="kt_datepicker_1">
            <i class="fas fa-calendar"></i>
          </button>
        </div>

        <!-- Calendar Grid -->
        <div class="calendar-container" id="calendar-grid"></div>

        <p class="mt-3"><b>LIVE</b> MATCHES</p>
        <div class="button-container" id="live"></div>

        <div class="scrollable-container"></div>
        <div class="d-flex justify-content-between">
          <div class="progress-dots">
            <div class="progress-bar-orange rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
          </div>
          <!-- Show All -->
          <p class="show-all" id="show-all-live">Show All</p>
        </div>

        <p class="mt-3"><b>UPCOMING</b> MATCHES</p>
        <div class="button-container" id="next"></div>

        <div class="scrollable-container"></div>
        <div class="d-flex justify-content-between">
          <div class="progress-dots">
            <div class="progress-bar-orange rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
          </div>
          <!-- Show All -->
          <p class="show-all" id="show-all-upcoming">Show All</p>
        </div>

        <p class="mt-3"><b>PREVIOUS</b> MATCHES</p>
        <div class="button-container" id="previous"></div>

        <div class="scrollable-container"></div>
        <div class="d-flex justify-content-between">
          <div class="progress-dots">
            <div class="progress-bar-orange rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
            <div class="dot rounded"></div>
          </div>
          <!-- Show All -->
          <p class="show-all" id="show-all-previous">Show All</p>
        </div>
      </div>
    </div>

    <!-- Sidebar Kanan -->
    <div class="col-md-3" id="right-content">
      <div class="p-3 rounded text-light bg-dark">
        <h5>Sidebar Kanan</h5>
        <ul class="list-unstyled">
          <li><a href="#" class="text-decoration-none">Link A</a></li>
          <li><a href="#" class="text-decoration-none">Link B</a></li>
          <li><a href="#" class="text-decoration-none">Link C</a></li>
          <li><a href="#" class="text-decoration-none">Link D</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js%}
<!-- Custom JavaScript -->
<script>
  function toggleStar(container) {
    container.classList.toggle("active"); // Tambah/hapus class aktif
  }
</script>
<script>
  async function reloadInitialView() {
    try {
      // Melakukan permintaan ke API untuk data awal
      const response = await fetch("/api/search/", {
        method: "GET", // Atur metode (GET/POST, dsb.)
        headers: {
          "Content-Type": "application/json", // Tipe konten permintaan
        },
      });
      const data = await response.json();

      const leftBar = document.getElementById("leftSide");
      leftBar.innerHTML = ""; // Kosongkan konten sebelumnya

      // Membuat Search Bar
      const searchDiv = document.createElement("div");
      searchDiv.classList.add("mb-4");
      searchDiv.innerHTML = `
        <input
          type="text"
          class="form-control"
          placeholder="Search..."
          id="searchInput"
        />
      `;
      leftBar.appendChild(searchDiv);

      // Membuat Region Section
      const regionDiv = document.createElement("div");
      regionDiv.classList.add("mb-4");
      regionDiv.innerHTML = `<h6 class="text-uppercase">Region</h6>`;
      const regionList = document.createElement("ul");
      regionList.classList.add("list-unstyled");
      regionList.id = "region";

      data.data.categories.forEach((region) => {
        const li = document.createElement("li");
        li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
        li.id = "leftCard";
        li.setAttribute(
          "onclick",
          `detailCountry('${region.Ccd}', '${region.Cnm}')`
        );
        li.innerHTML = `
          <img
            src="${region.badgeUrl || "default-region.png"}"
            alt="${region.Ccd}"
            class="me-3"
            style="width: 20px; object-fit: cover"
          />
          <div class="d-flex flex-column">
            <span class="text-truncate">${region.Cnm}</span>
            <small class="text-light text-truncate"></small>
          </div>
        `;
        regionList.appendChild(li);
      });
      regionDiv.appendChild(regionList);
      leftBar.appendChild(regionDiv);

      // Membuat Teams Section
      const teamsDiv = document.createElement("div");
      teamsDiv.innerHTML = `<h6 class="text-uppercase">Teams</h6>`;
      const teamsList = document.createElement("ul");
      teamsList.classList.add("list-unstyled");
      teamsList.id = "teams";

      data.data.teams.forEach((team) => {
        const li = document.createElement("li");
        li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
        li.id = "leftCard";
        li.innerHTML = `
          <img
            src="${team.IMGTeam || "default-team.png"}"
            alt="${team.NMTeam}"
            class="me-3"
            style="width: 20px; object-fit: cover"
          />
          <div class="d-flex flex-column">
            <span class="text-truncate">${team.NMTeam}</span>
            <small class="text-light text-truncate">${team.CoNm}</small>
          </div>
        `;
        li.addEventListener("click", () => {
          window.location.href = `/team/${team.IDTeam}/`; // Gunakan data.url sebagai target URL
        });
        teamsList.appendChild(li);
      });
      teamsDiv.appendChild(teamsList);
      leftBar.appendChild(teamsDiv);

      // Membuat Competition Section
      const competitionDiv = document.createElement("div");
      competitionDiv.classList.add("mb-4");
      competitionDiv.innerHTML = `<h6 class="text-uppercase">Competition</h6>`;
      const competitionList = document.createElement("ul");
      competitionList.classList.add("list-unstyled");
      competitionList.id = "competition";

      data.data.stages.forEach((competition) => {
        const li = document.createElement("li");
        li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
        li.id = "leftCard";
        li.innerHTML = `
          <img
            src="${competition.badgeUrl || "default-competition.png"}"
            alt="${competition.Scd}"
            class="me-3"
            style="width: 20px; object-fit: cover"
          />
          <div class="d-flex flex-column">
            <span class="text-truncate">${competition.Snm}</span>
            <small class="text-light text-truncate">${competition.Cnm}</small>
          </div>
        `;
        li.addEventListener("click", () => {
          var modifiedString = competition.urlComp.replace(".", "/");
          window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
        });
        competitionList.appendChild(li);
      });
      competitionDiv.appendChild(competitionList);
      leftBar.appendChild(competitionDiv);

      // Tambahkan event listener ke searchInput untuk live search
      const searchInput = document.getElementById("searchInput");
      searchInput.addEventListener(
        "input",
        debounce(async (e) => {
          const query = e.target.value.trim(); // Dapatkan teks pencarian
          if (query) {
            await performSearch(query); // Panggil fungsi pencarian
          } else {
            reloadInitialView(); // Reset ke tampilan awal jika input kosong
          }
        }, 300) // Debounce selama 300ms
      );
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  }

  // Fungsi debounce
  const debounce = (func, delay) => {
    let timeout;
    return (...args) => {
      clearTimeout(timeout);
      timeout = setTimeout(() => func(...args), delay);
    };
  };

  // Fungsi performSearch
  const performSearch = async (query) => {
    try {
      const response = await fetch(`/api/search/${query}/`);
      const data = await response.json();

      const regionList = document.getElementById("region");
      const teamList = document.getElementById("teams");
      const compList = document.getElementById("competition");

      // Kosongkan daftar sebelumnya
      regionList.innerHTML = "";
      teamList.innerHTML = "";
      compList.innerHTML = "";

      // Tambahkan hasil pencarian
      populateList(regionList, data.data.categories, createRegionItem);
      populateList(teamList, data.data.teams, createTeamItem);
      populateList(compList, data.data.stages, createCompetitionItem);
    } catch (error) {
      console.error("Error in performSearch:", error);
    }
  };

  // Fungsi untuk mengisi daftar
  const populateList = (list, data, createItem) => {
    if (data && data.length) {
      data.forEach((item) => list.appendChild(createItem(item)));
    } else {
      list.innerHTML = "<li class='text-muted'>No results found</li>";
    }
  };

  // Fungsi pembuat item untuk region, team, dan competition
  const createRegionItem = (region) => {
    const li = document.createElement("li");
    li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
    li.id = "leftCard";
    li.setAttribute(
      "onclick",
      `detailCountry('${region.Ccd}', '${region.Cnm}')`
    );
    li.innerHTML = `
      <img
        src="${region.badgeUrl || "default-region.png"}"
        alt="${region.Ccd}"
        class="me-3"
        style="width: 20px; object-fit: cover"
      />
      <div class="d-flex flex-column">
        <span class="text-truncate">${region.Cnm}</span>
      </div>
    `;
    return li;
  };

  const createTeamItem = (team) => {
    const li = document.createElement("li");
    li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
    li.id = "leftCard";
    li.innerHTML = `
      <img
        src="${team.IMGTeam || "default-team.png"}"
        alt="${team.NMTeam}"
        class="me-3"
        style="width: 20px; object-fit: cover"
      />
      <div class="d-flex flex-column">
        <span class="text-truncate">${team.NMTeam}</span>
        <small class="text-light text-truncate">${team.CoNm}</small>
      </div>
    `;
    li.addEventListener("click", () => {
      window.location.href = `/team/${team.IDTeam}/`; // Gunakan data.url sebagai target URL
    });
    return li;
  };

  const createCompetitionItem = (competition) => {
    const li = document.createElement("li");
    li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
    li.id = "leftCard";
    li.innerHTML = `
      <img
        src="${competition.badgeUrl || "default-competition.png"}"
        alt="${competition.Scd}"
        class="me-3"
        style="width: 20px; object-fit: cover"
      />
      <div class="d-flex flex-column">
        <span class="text-truncate">${competition.Snm}</span>
        <small class="text-light text-truncate">${competition.Cnm}</small>
      </div>
    `;
    li.addEventListener("click", () => {
      var modifiedString = competition.urlComp.replace(".", "/");
      window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
    });
    return li;
  };

  // Panggil fungsi utama saat halaman dimuat
  document.addEventListener("DOMContentLoaded", reloadInitialView);
</script>
<script>
  async function detailCountry(country, title) {
    try {
      // Melakukan permintaan ke API
      const response = await fetch(`/api/football/detailCountry/${country}`);
      const data = await response.json();

      const leftBar = document.getElementById("leftSide");
      leftBar.innerHTML = ""; // Kosongkan konten sebelumnya

      const countryData = data["data"];
      if (countryData && countryData.length > 0) {
        // Membuat elemen tombol kembali
        const div = document.createElement("div");
        div.classList.add("mb-4");
        div.innerHTML = `
          <button
            id="back-button"
            class="btn text-white d-flex align-items-center"
            onclick="reloadInitialView()"
          >
            <i class="fas fa-arrow-left"></i>
            <span id="header-title" class="ms-2">${title}</span>
          </button>`;
        leftBar.appendChild(div);

        // Membuat daftar kompetisi
        const ul = document.createElement("ul");
        ul.classList.add("list-unstyled");

        // Looping data kompetisi dan membuat elemen <li>
        countryData.forEach((datas) => {
          const li = document.createElement("li");
          li.classList.add("d-flex", "align-items-center", "mb-3", "p-2");
          li.id = "leftCard";

          li.innerHTML = `
            <img
              src="${datas.badgeUrl || "default-badge.png"}"
              alt="${datas.Scd}"
              class="me-3"
              style="width: 20px; object-fit: cover"
            />
            <div class="d-flex flex-column">
              <span>${datas.Snm}</span>
              <small class="text-light"></small>
            </div>
          `;
          li.addEventListener("click", () => {
            var modifiedString = datas.urlComp.replace(".", "/");
            window.location.href = `/comp/${modifiedString}/`; // Gunakan data.url sebagai target URL
          });
          ul.appendChild(li);
        });

        // Menambahkan daftar ke dalam `leftBar`
        leftBar.appendChild(ul);
      }
    } catch (error) {
      console.error("Error fetching country details:", error);
    }
  }
</script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
  const calendarBtn = document.getElementById("kt_datepicker_1");

  // Inisialisasi Flatpickr
  calendarBtn.flatpickr({
    dateFormat: "Ymd", // Format tanggal menjadi 20250107
    disableMobile: "true",
    onChange: function (selectedDates, dateStr, instance) {
      fetchSortedData(dateStr); // Cetak tanggal ke konsol
      generateCalendar(dateStr);
    },
  });
</script>
<script>
  let offset = 0;

  function slideRight() {
    const slider = document.getElementById("slider");
    const itemWidth = slider.children[0].offsetWidth + 16; // Include margin
    offset -= itemWidth;

    // Check if last item is reached
    if (
      Math.abs(offset) >=
      slider.scrollWidth - slider.parentNode.offsetWidth
    ) {
      offset = 0; // Reset to start
    }

    slider.style.transform = `translateX(${offset}px)`;
  }

  function slideLeft() {
    const slider = document.getElementById("slider");
    const itemWidth = slider.children[0].offsetWidth + 16; // Include margin
    offset += itemWidth;

    // Check if start is reached
    if (offset > 0) {
      offset = -(slider.scrollWidth - slider.parentNode.offsetWidth); // Go to the end
    }

    slider.style.transform = `translateX(${offset}px)`;
  }
</script>

<script>
  async function fetchSortedData(dateParam = null) {
    const uri = dateParam
      ? `/api/sorted_data/${dateParam}/` // Jika ada dateParam, tambahkan ke URL
      : "/api/sorted_data/"; // Jika tidak ada, panggil tanpa parameter

    const scrollableContainers = document.getElementsByClassName(
      "scrollable-container"
    );

    // Loop melalui semua elemen yang ditemukan dan kosongkan isinya
    Array.from(scrollableContainers).forEach((container) => {
      container.innerHTML = ""; // Kosongkan konten HTML dari elemen
    });
    try {
      // Mengirimkan permintaan ke URL yang sesuai
      const response = await fetch(uri, {
        method: "GET", // Atur metode (GET/POST, dsb.)
        headers: {
          "Content-Type": "application/json", // Tipe konten permintaan
        },
      });
      const sortedData = await response.json();

      const buttonContainerLive = document.getElementById("live");
      buttonContainerLive.innerHTML = "";

      const categoryDataLive = sortedData["live"];
      const showAllLive = document.getElementById("show-all-live");
      showAllLive.addEventListener("click", function () {
        showAll(categoryDataLive, "LIVE");
      });

      if (categoryDataLive && categoryDataLive.length > 0) {
        categoryDataLive.forEach((category, index) => {
          const button = document.createElement("button");
          button.classList.add("circle-button");

          // Jika data adalah elemen ke-0, tambahkan kelas 'active'
          if (index === 0) {
            button.classList.add("active");
            displayCategory(category, 0, category.urlComp);
          }

          button.innerHTML = `
              <div class="icon">
                  <img src="${category.badgeUrl || "default-icon.png"}" alt="${
            category.Scd
          }" />
              </div>
              <span>${category.Snm}</span>
          `;

          button.addEventListener("click", () => {
            // Hapus kelas 'active' dari semua tombol di container
            const buttons =
              buttonContainerLive.getElementsByClassName("circle-button");
            Array.from(buttons).forEach((btn) =>
              btn.classList.remove("active")
            );

            // Tambahkan kelas 'active' pada tombol yang diklik
            button.classList.add("active");

            // Panggil fungsi untuk menampilkan data kategori
            displayCategory(category, 0, category.urlComp);
          });

          buttonContainerLive.appendChild(button);
        });
      }

      const buttonContainerNext = document.getElementById("next");
      buttonContainerNext.innerHTML = "";

      const categoryDataNext = sortedData["next"];
      const showAllNext = document.getElementById("show-all-upcoming");
      showAllNext.addEventListener("click", function () {
        showAll(categoryDataNext, "UPCOMING");
      });
      if (categoryDataNext && categoryDataNext.length > 0) {
        categoryDataNext.forEach((category, index) => {
          const button = document.createElement("button");
          button.classList.add("circle-button");

          // Jika data adalah elemen ke-0, tambahkan kelas 'active'
          if (index === 0) {
            button.classList.add("active");
            displayCategory(category, 1, category.urlComp);
          }

          button.innerHTML = `
              <div class="icon">
                  <img src="${category.badgeUrl || "default-icon.png"}" alt="${
            category.Scd
          }" />
              </div>
              <span>${category.Snm}</span>
          `;

          button.addEventListener("click", () => {
            // Hapus kelas 'active' dari semua tombol di container
            const buttons =
              buttonContainerNext.getElementsByClassName("circle-button");
            Array.from(buttons).forEach((btn) =>
              btn.classList.remove("active")
            );

            // Tambahkan kelas 'active' pada tombol yang diklik
            button.classList.add("active");

            // Panggil fungsi untuk menampilkan data kategori
            displayCategory(category, 1, category.urlComp);
          });

          buttonContainerNext.appendChild(button);
        });
      }

      const buttonContainerPrevious = document.getElementById("previous");
      buttonContainerPrevious.innerHTML = "";

      const categoryDataPre = sortedData["previous"];
      const showAllPre = document.getElementById("show-all-previous");
      showAllPre.addEventListener("click", function () {
        showAll(categoryDataPre, "PREVIOUS");
      });
      if (categoryDataPre && categoryDataPre.length > 0) {
        categoryDataPre.forEach((category, index) => {
          const button = document.createElement("button");
          button.innerHTML = "";
          button.classList.add("circle-button");

          // Jika data adalah elemen ke-0, tambahkan kelas 'active'
          if (index === 0) {
            button.classList.add("active");
            displayCategory(category, 2, category.urlComp);
          }

          button.innerHTML = `
              <div class="icon">
                  <img src="${category.badgeUrl || "default-icon.png"}" alt="${
            category.Scd
          }" />
              </div>
              <span class="title">${category.Snm}</span>
          `;

          button.addEventListener("click", () => {
            // Hapus kelas 'active' dari semua tombol di container
            const buttons =
              buttonContainerPrevious.getElementsByClassName("circle-button");
            Array.from(buttons).forEach((btn) =>
              btn.classList.remove("active")
            );

            // Tambahkan kelas 'active' pada tombol yang diklik
            button.classList.add("active");

            // Panggil fungsi untuk menampilkan data kategori
            displayCategory(category, 2, category.urlComp);
          });

          buttonContainerPrevious.appendChild(button);
        });
      }
    } catch (error) {
      console.error("Error fetching data:", error);
    }
  }

  function showAll(data, title) {
    // Ambil elemen utama
    const mainDiv = document.getElementById("main-div");
    const rightContent = document.getElementById("right-content");

    // Hapus konten dari elemen yang ada
    rightContent.innerHTML = ""; // Kosongkan elemen "right-content"
    mainDiv.innerHTML = ""; // Kosongkan elemen "main-div"

    // Reset class dari elemen utama dan tambahkan class baru
    mainDiv.className = "col-md-8"; // Langsung menetapkan class baru

    // Buat elemen konten utama
    const mainContent = document.createElement("div");
    mainContent.classList.add(
      "p-3",
      "rounded",
      "shadow-sm",
      "bg-dark",
      "text-light"
    );

    mainContent.innerHTML = `
      <p>
        <a href="/" style="text-decoration: none;">
          <i class="fas fa-arrow-left" style="color: white;"></i>
        </a> 
        <b>${title}</b> MATCHES
      </p>
      <div class="button-container" id="button-container"></div>

      <div class="grid-container"></div>
    `;

    // Tambahkan elemen konten utama ke dalam elemen utama
    mainDiv.appendChild(mainContent);

    // Ambil elemen container tombol
    const buttonContainerLive = document.getElementById("button-container");

    if (data && data.length > 0) {
      data.forEach((datas, index) => {
        // Buat tombol untuk setiap item data
        const button = document.createElement("button");
        button.classList.add("circle-button");

        // Jika data adalah elemen ke-0, tambahkan kelas 'active' dan tampilkan kategori pertama
        if (index === 0) {
          button.classList.add("active");
          displayAll(datas, 0, datas.urlComp); // Pastikan fungsi ini ada dan berfungsi
        }

        // Isi tombol dengan data
        button.innerHTML = `
          <div class="icon">
            <img src="${datas.badgeUrl || "default-icon.png"}" alt="${
          datas.Scd
        }" />
          </div>
          <span>${datas.Snm}</span>
        `;

        // Tambahkan event listener untuk klik pada tombol
        button.addEventListener("click", () => {
          // Hapus kelas 'active' dari semua tombol di container
          const buttons =
            buttonContainerLive.getElementsByClassName("circle-button");
          Array.from(buttons).forEach((btn) => btn.classList.remove("active"));

          // Tambahkan kelas 'active' pada tombol yang diklik
          button.classList.add("active");

          // Panggil fungsi untuk menampilkan data kategori
          displayAll(datas, 0, datas.urlComp); // Pastikan fungsi ini ada
        });

        // Tambahkan tombol ke dalam container
        buttonContainerLive.appendChild(button);
      });
    } else {
      // Tampilkan pesan jika data kosong
      buttonContainerLive.innerHTML = `<p class="text-center text-muted">No matches available.</p>`;
    }
  }

  function displayAll(category, index, urlComp) {
    // Ambil elemen container tempat card akan ditempatkan
    const scrollableContainer =
      document.getElementsByClassName("grid-container")[index];
    scrollableContainer.innerHTML = ""; // Menghapus semua konten sebelumnya

    // Periksa jika ada events dalam kategori
    if (category && category.events && Array.isArray(category.events)) {
      category.events.forEach((data) => {
        // Buat card div
        const card = document.createElement("div");
        card.classList.add("card");

        let score1Html = "";
        let score2Html = "";
        // Cek apakah event.Score1 ada isinya
        if (
          data.Score1 !== null &&
          data.Score1 !== undefined &&
          data.Score1 !== ""
        ) {
          score1Html = `<span class="team-score">${data.Score1}</span>`; // Tampilkan jika ada
        }

        // Cek apakah event.Score2 ada isinya
        if (
          data.Score2 !== null &&
          data.Score2 !== undefined &&
          data.Score2 !== ""
        ) {
          score2Html = `<span class="team-score">${data.Score2}</span>`; // Tampilkan jika ada
        }

        if (index == 1) {
          card.innerHTML = `
              <div class="card-header">
                <div class="d-flex justify-content-between">
                    <span class="team-name">${data.Status_Match}</span>
                    <span class="team-score">
                      <div class="star-container" onclick="toggleStar(this)">
                        <img src={{ url_for('static', filename='img/star_border.png') }} class="star default" alt="Star Border">
                        <img src={{ url_for('static', filename='img/star.png') }} class="star filled" alt="Star Filled">
                      </div>
                    </span>
                </div>
              </div>
              <div class="card-body">
                <div class="text-center">
                  <div class="team-logos">
                    <img
                      src="${data.Team1.IMGTeam}"
                      alt="${data.Team1.NMTeam}"
                    />
                    <span>VS</span>
                    <img
                      src="${data.Team2.IMGTeam}"
                      alt="${data.Team2.NMTeam}"
                    />
                  </div>
                  <div class="divider"></div>
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team1.NMTeam}</span>
                      ${score1Html}
                  </div>
                  <!-- Row for the second team -->
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team2.NMTeam}</span>
                      ${score2Html}
                  </div>
                  <div class="divider"></div>
                </div>
                <p class="match-info">📅 ${formatTimestamp(
                  data.time_start
                )}<br /></p>
              </div>
          `;
        } else {
          card.innerHTML = `
              <div class="card-header">
                <div class="d-flex justify-content-between">
                    <span class="team-name">${data.Status_Match}</span>
                    <span class="team-score">
                      <div class="star-container" onclick="toggleStar(this)">
                        <img src={{ url_for('static', filename='img/star_border.png') }} class="star default" alt="Star Border">
                        <img src={{ url_for('static', filename='img/star.png') }} class="star filled" alt="Star Filled">
                      </div>
                    </span>
                </div>
              </div>
              <div class="card-body">
                <div class="text-center">
                  <div class="team-logos">
                    <img
                      src="${data.Team1.IMGTeam}"
                      alt="${data.Team1.NMTeam}"
                    />
                    <span>VS</span>
                    <img
                      src="${data.Team2.IMGTeam}"
                      alt="${data.Team2.NMTeam}"
                    />
                  </div>
                  <div class="divider"></div>
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team1.NMTeam}</span>
                      ${score1Html}
                  </div>
                  <!-- Row for the second team -->
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team2.NMTeam}</span>
                      ${score2Html}
                  </div>
                  <div class="divider"></div>
                </div>
                <p class="match-info">📅 ${formatTimestamp(
                  data.time_start
                )}<br /></p>
              </div>
          `;
        }
        // Tambahkan event listener untuk mengarahkan ke URL
        card.addEventListener("click", () => {
          window.location.href = `/match/${urlComp}/${data.IDMatch}`; // Gunakan data.url sebagai target URL
        });

        // Opsional: Tambahkan gaya kursor agar pengguna tahu card dapat diklik
        card.style.cursor = "pointer";

        // Menambahkan card ke dalam container
        scrollableContainer.appendChild(card);
      });
    } else {
      console.log("No events data available.");
    }
  }

  function displayCategory(category, index, urlComp) {
    // Ambil elemen container tempat card akan ditempatkan
    const scrollableContainer = document.getElementsByClassName(
      "scrollable-container"
    )[index];
    scrollableContainer.innerHTML = ""; // Menghapus semua konten sebelumnya

    // Periksa jika ada events dalam kategori
    if (category && category.events && Array.isArray(category.events)) {
      category.events.forEach((data) => {
        // Buat card div
        const card = document.createElement("div");
        card.classList.add("card");

        if (index == 1) {
          card.innerHTML = `
              <div class="card-header">
                <div class="d-flex justify-content-between">
                    <span class="team-name">${data.Status_Match}</span>
                    <span class="team-score">
                      <div class="star-container" onclick="toggleStar(this)">
                        <img src={{ url_for('static', filename='img/star_border.png') }} class="star default" alt="Star Border">
                        <img src={{ url_for('static', filename='img/star.png') }} class="star filled" alt="Star Filled">
                      </div>
                    </span>
                </div>
              </div>
              <div class="card-body">
                <div class="text-center">
                  <div class="team-logos">
                    <img
                      src="${data.Team1.IMGTeam}"
                      alt="${data.Team1.NMTeam}"
                    />
                    <span>VS</span>
                    <img
                      src="${data.Team2.IMGTeam}"
                      alt="${data.Team2.NMTeam}"
                    />
                  </div>
                  <div class="divider"></div>
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team1.NMTeam}</span>
                  </div>
                  <!-- Row for the second team -->
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team2.NMTeam}</span>
                  </div>
                  <div class="divider"></div>
                </div>
                <p class="match-info">📅 ${formatTimestamp(
                  data.time_start
                )}<br /></p>
              </div>
          `;
        } else {
          card.innerHTML = `
              <div class="card-header">
                <div class="d-flex justify-content-between">
                    <span class="team-name">${data.Status_Match}</span>
                    <span class="team-score">
                      <div class="star-container" onclick="toggleStar(this)">
                        <img src={{ url_for('static', filename='img/star_border.png') }} class="star default" alt="Star Border">
                        <img src={{ url_for('static', filename='img/star.png') }} class="star filled" alt="Star Filled">
                      </div>
                    </span>
                </div>
              </div>
              <div class="card-body">
                <div class="text-center">
                  <div class="team-logos">
                    <img
                      src="${data.Team1.IMGTeam}"
                      alt="${data.Team1.NMTeam}"
                    />
                    <span>VS</span>
                    <img
                      src="${data.Team2.IMGTeam}"
                      alt="${data.Team2.NMTeam}"
                    />
                  </div>
                  <div class="divider"></div>
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team1.NMTeam}</span>
                      <span class="team-score">${data.Score1}</span>
                  </div>
                  <!-- Row for the second team -->
                  <div class="d-flex justify-content-between">
                      <span class="team-name">${data.Team2.NMTeam}</span>
                      <span class="team-score">${data.Score2}</span>
                  </div>
                  <div class="divider"></div>
                </div>
                <p class="match-info">📅 ${formatTimestamp(
                  data.time_start
                )}<br /></p>
              </div>
          `;
        }
        // Tambahkan event listener untuk mengarahkan ke URL
        card.addEventListener("click", () => {
          window.location.href = `/match/${urlComp}/${data.IDMatch}`; // Gunakan data.url sebagai target URL
        });

        // Opsional: Tambahkan gaya kursor agar pengguna tahu card dapat diklik
        card.style.cursor = "pointer";

        // Menambahkan card ke dalam container
        scrollableContainer.appendChild(card);
      });
    } else {
      console.log("No events data available.");
    }
  }

  function formatTimestamp(timestamp) {
    // Memastikan bahwa timestamp adalah string
    let ts = timestamp.toString();

    // Mengambil bagian-bagian dari timestamp
    let year = ts.substring(0, 4); // Ambil tahun
    let month = ts.substring(4, 6); // Ambil bulan
    let day = ts.substring(6, 8); // Ambil hari
    let hour = ts.substring(8, 10); // Ambil jam
    let minute = ts.substring(10, 12); // Ambil menit

    // Array untuk nama bulan
    const months = [
      "Jan",
      "Feb",
      "Mar",
      "Apr",
      "May",
      "Jun",
      "Jul",
      "Aug",
      "Sep",
      "Oct",
      "Nov",
      "Dec",
    ];

    // Menyusun string hasil format
    let formattedDate = `${day} ${
      months[parseInt(month) - 1]
    } ${year} - ${hour}.${minute}`;

    return formattedDate;
  }

  // Call fetch function on page load
  fetchSortedData();
</script>
<script>
  function convertYmdToDate(ymdString) {
    const year = parseInt(ymdString.substring(0, 4)); // Ambil 4 digit pertama untuk tahun
    const month = parseInt(ymdString.substring(4, 6)) - 1; // Ambil 2 digit berikutnya untuk bulan (0-based index)
    const day = parseInt(ymdString.substring(6, 8)); // Ambil 2 digit terakhir untuk hari

    return new Date(year, month, day); // Buat objek Date
  }

  function generateCalendar(dateParam = null) {
    const today = dateParam
      ? convertYmdToDate(dateParam) // Jika ada dateParam, gunakan fungsi untuk konversi
      : new Date(); // Jika tidak ada dateParam, gunakan tanggal hari ini
    const calendarGrid = document.getElementById("calendar-grid");
    calendarGrid.innerHTML = "";
    const calendarMonth = document.getElementById("calendar-month");

    // Set the month and year in the header
    const options = { month: "long", year: "numeric" };
    calendarMonth.textContent = today.toLocaleDateString("en-US", options);

    // Calculate dates
    const days = [];
    for (let i = -2; i <= 2; i++) {
      const date = new Date();
      date.setDate(today.getDate() + i); // Shift the date by i days
      days.push(date);
    }

    // Create calendar cards
    days.forEach((date, index) => {
      const card = document.createElement("div");
      card.classList.add("calendar-card");
      const year = date.getFullYear(); // Tahun (YYYY)
      const month = (date.getMonth() + 1).toString().padStart(2, "0"); // Bulan (MM) dengan dua digit
      const day = date.getDate().toString().padStart(2, "0"); // Hari (DD) dengan dua digit

      const formattedDate = `${year}${month}${day}`; // Format YYYYMMDD

      // Highlight the "today" card (3rd card, index 2)
      if (index === 2) {
        card.classList.add("active");
      }

      // Format the date
      const dayName = date
        .toLocaleDateString("en-US", { weekday: "short" })
        .toUpperCase(); // e.g., "SUN"
      const dayNumber = date.getDate(); // e.g., "01"

      card.innerHTML = `
        <span>${dayName}</span>
        <span>${dayNumber}</span>
      `;

      // Add click event listener to make it selectable
      card.addEventListener("click", () => {
        // Remove active class from all cards
        document
          .querySelectorAll(".calendar-card")
          .forEach((c) => c.classList.remove("active"));

        // Add active class to the clicked card
        card.classList.add("active");
        fetchSortedData(formattedDate);

        // Display selected date in the console
        console.log(`Selected date: ${date.toDateString()}`);
      });

      // Append the card to the grid
      calendarGrid.appendChild(card);
    });
  }

  // Generate the calendar on page load
  generateCalendar();
</script>
{% endblock %}
